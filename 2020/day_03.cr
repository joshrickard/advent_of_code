# https://adventofcode.com/2020/day/3

map_data = <<-MAP
  .......#..#....#...#...#......#
  ..##..#...##.###.#..#.....#.#..
  #..#.#....#......#..#.........#
  .#..##...#........#....#..#..#.
  #.#.#....###...#........#.....#
  .#...#.#.##.#.##...#.#.........
  ####......#.......###.##.#.....
  ..#...........#...#.#.#........
  .#.......#....###.####..#......
  ...##........#....##.......##..
  .###......##.#......##....#.#.#
  ........#.#......##...#......#.
  #....##.#..#...#.......#.......
  .#..##........##.........#....#
  .#..#..#...#....#.#......#.#...
  ..#.#......##.#.......#....##..
  ......##......#.#..##.#..#...#.
  .....##.......#.#....#.#.......
  ........#.....#.....#..###.#...
  #........#..#.....#...#.#.#..#.
  .#..#.....#...#........#.....#.
  .#.#.....#.....#...#...........
  .....#.#..#..#...#..#..#..##..#
  ##.#...#....#..#.##..#.....#.#.
  #.......####......#..#.#....#..
  ......#.#...####.........#.#..#
  .#.........#..#.#...#..........
  ...#####.#....#.#..#......#.#.#
  ##....#.###....##...##..#.....#
  ...........####.##.#....##.##..
  #.#.#..........#.#..##.#.######
  ##...#..#...........###..#....#
  .#.#.#...##..........##.#...#..
  ...#.#........#..##...#....#...
  ......#..#...#..##....#.......#
  .#..#.......#..#......##....##.
  .......#.......#........#..##..
  ...#...#...#.##......#.##.#....
  .........#.........#.#.#.##....
  ..#...................#....#..#
  .........#..#.....#.#...#....#.
  #.#.#...#........#..###.#......
  #.#.#.####......##...#...#....#
  #...........##..#.#.#....#..#..
  ........#..#.#...........##.#.#
  .#.........#...........#..#....
  #............##.#..#....##...##
  .#....##..#.#....#.......#..#..
  ..#.#...#.#......####.......#..
  ...#.#.......###......#.....#..
  #......#.......#.#...#.#..##...
  ...#.....#...##.#.....#.#......
  #.#.#............#..#......#..#
  ....#...#...##.##.##...##.#....
  ..##........#..#........#...##.
  .......#..#...#.........#.....#
  ...........#.#......#...#......
  ...##..##..##..###..#..#..#..#.
  #..##.......##..#....#....#.#..
  #.#.##.#..##.....#....#.#......
  ....#..##......#.#..#....#....#
  .#.#.........##...#......##.##.
  ##...........#..#.....#.###....
  .#.###........#...#....##..#...
  ......##.....#.................
  .#.##..#.#.......#......#.#.#..
  .#...#....#.##..........##.##..
  #...##......####.#....#....#...
  .#...#.##.#.#.....#...#........
  .#................#.##.#.###...
  ...#.#..#.#.....##.....##....#.
  ..##.#..#..##.....#....#...#.##
  ........###.##..#..###.....#..#
  ..##.....#.......#.#...##......
  #.#..###...##.###.##.#..#...#..
  #..#..#.#...#....#...##.....#.#
  #..................#........#..
  #.....#.......#.##....##....#..
  ...#.............#.....#...#...
  ...#...#.##..##.....#........#.
  .......#........##....###..##..
  .#....#....#.#..#......#....#.#
  ..........#..#.#.....##...#.##.
  .#...##.#...........#.#.......#
  ..#.##.....#.###.#.............
  ..#....###..........#.#.#......
  #.....#.####..#.#......#..#.#.#
  ...#........#..#...............
  .###.#.##.....#.#...........#..
  ..#....#..#....#..##....#......
  ......#..#.....#.#.##.......#.#
  ###..#...#.#..#....#..##.###..#
  .#....##.###........##...##.#.#
  ........##..##.#....##..#....#.
  ...#..#....#.#....#...#...##...
  #.....#......#.##........#....#
  ....#....###.##...#.#.##....#..
  ......#.##..#.#..........#...#.
  ...........#...#....##...#....#
  ......#.#.........#....#.#.#...
  .###..........#.###.##....#...#
  ...##.......#......#....#....#.
  #..#...#.#..####...#......#..#.
  ....##..#.#.........#..........
  .##.###.##....##.####....#...#.
  ..##.......#........#...#..#...
  ....#####..........###....#....
  .#.#..#.#.#....#..#............
  ........#.....#....#.......##..
  ...........##....##..##.....##.
  ..###........#.#.#..#....##...#
  .....#...........##......#..#..
  ...##........#.##.#......##..#.
  ##..#....#............##..#..#.
  .#.....#...##.##..............#
  #..##........#...#...#......##.
  ......##.....#.......####.##..#
  ...#.#....#...#..#.............
  ..#...#..##.###..#..#.......##.
  ##....###.......#...#..#.......
  #..#.....###.....#.#.........#.
  #.#....#.............#...#.....
  ..#.#.##..........#.....##.#...
  .....##......#..#..#.....#..#..
  ##.#..#..#.##......###....#..#.
  ...#............##...#..##.....
  .#..#....#.........#......#.##.
  .##.##...#..............#..#.##
  ...#....#...###...#...#....#..#
  ..#...#..####..#....#.#...##..#
  ..............##.##.......##...
  ..##.#..##...........#.#.#...#.
  ..................##.####.###..
  .#...........#.......#......#..
  .#.#.#...#....#.........##...##
  ....#..........#.#....#.#.....#
  ..........#.#..........#.#.....
  ...........#.....#.#......#....
  ........#..#.#.#.#.............
  ...###...##...##..####.##......
  .#..#......###.....#...#.....#.
  .........##............#.#.....
  #.#..#.#.#....###.#.#..#..#..##
  ..........#...#.##.#..#..#....#
  #..#.......##....#..##........#
  ##.#...#....##.............#...
  ....#........#......##..#..#.##
  .................#.#.#.#.#.....
  ...........#.#.....#.......#...
  #.......#.......#............#.
  ....#...........#.#.##.....#..#
  #...#.....#....#..##...#.......
  ..#.....#.....#.##.##....#.....
  .#.#..#...#..#..##.....##..#...
  .#.#....#.........####.........
  #...#..####.....#...#..##......
  ..#...##.#.....#...#.....##....
  .#...#.....#.#.#......#.......#
  ..#.....##.#..#.#...##.........
  ##.#...#..#....#....#.##.##...#
  .#..#....#..##.#.......#..#....
  ...##.#......#...###.......#...
  ...#..#.........##.####........
  #.#..#..##...........#..#......
  .#...#.#......#.#..........#...
  ...###...#.......#.....#.#...##
  ..#....#.#.##..........##...#..
  .....###.........#.....#..##..#
  .......##.....#.#.....#.#..##..
  .#.#.###..##.......##...#......
  ......#.....#................##
  .#......##..##.#.#...#...#...##
  .#...#......#.......#.#........
  .#..........###...#..#...#.....
  .........##.....#.#..#..#.#...#
  #...#...#.........#..#..#....#.
  ###.......#.#.....#....##......
  .#..#......#..#...........#..#.
  ..##....##..##...#......#......
  .#........#....#...#....#.....#
  .#.......#...#...#..##.#.#..#..
  #...#........#.##.....#.....#..
  #..##.....#..........#...#...##
  ............#...............#..
  .#.##...#.....#.#..#..#..#.....
  .#.#.#...#........#....#...##..
  ##......#.....#.###.#...#.#..#.
  .........##..#..#.#...#...#...#
  #...#.#....#..#..#.....#.......
  .......#.###...#.............#.
  ..#.....#.#.#..###.#....#.....#
  ....#...#.#....#.#..........#..
  ..#......#.###.#.#..#.....#...#
  #............#..##...##......#.
  #...........#..#....#.###..###.
  .#.##.#.#.......#.............#
  ..............#................
  ..#.#.....#.....#...#......#...
  .#.#.#..#..#.#...........##....
  .....##.#......#..#.##....#....
  .......##..#.#.#..#............
  ..#.....#.....#.###..#.....#.#.
  ......##.....#..##.#...#.....#.
  ...#...#....#..#..#........#...
  ..#.##..#....#.........#.#..#..
  #....#.....###.....#......#....
  ##.....#..#..##.........#.##.##
  .#.#....#.#..........#.........
  .##.#...#..#.......#.##...#....
  ...#...#.....#....#...#.#..#...
  .....#....#.....#.....#.#......
  ...........#.#.......#.......#.
  .........##.###.##........#....
  #..##.....#...#.#..............
  .#...#....##........#.#..#....#
  ..#...#........#...#..#.##.#..#
  ........#...#.....##.#.#....#.#
  #..#.......###.#....#.#.#......
  .......#...##....#...#..##..#..
  .....##........#.#.#..#....##..
  .#....#..#.#...........#......#
  ...##....#.##.....##.......#...
  .##..#..#....#.#....#..#....##.
  ..#....#.....###.......#..##..#
  ....#.......#....##..#....#..##
  ....#......##..#....#.#...#.#..
  .##.#......##..................
  ##.#....#........#..#..#...##.#
  .......#..#.#...##.....#.#.....
  ..##.#...........#.#.#..#.#.#..
  .....#....#......#..#.......#..
  #.#...#.####..##.......#..##...
  ...#....#.....#.##.#..#.##..#..
  .#.......#......##........##.#.
  .......#.#...#..#...#..##.#....
  .#....#........#.#.....##..#..#
  #..#.....#..#.............#...#
  #...#....#..#...###..#...#.#...
  .#..#.....#..........#..##.####
  #.#.#.#.##.#.#.....##.#........
  ...#....##....#...#..##.......#
  ..##.##.#.#........#..........#
  ..###........###..#..........#.
  ...#......#..##.#........#..#..
  #.#.#..#........#..#..........#
  ...#........#..##.#...#.###....
  ##......#.####.#....#......#...
  .#..#......#................#..
  #.#........#.#.....##.....##...
  #...............#..#.......#.#.
  .##..#...........##..#..#.#....
  #......#.#.......#.#.#.##..#.##
  .....##.#..###.............##..
  ....##.........#..#...#........
  .....#.....#.#.#..#.#..........
  #.........#....##.#.##.....#..#
  .#.........#......#.#.##.#.#...
  ##.........#.....#..#.#..#.##.#
  ....#......##...#.....#..#..###
  ..#..............#...#..####...
  #....#...##.#.......#...#..#...
  #.......###.#.#.......#.......#
  ...##....#.#...........#...###.
  ...........#..#.#.....#..##..#.
  ..#.........#..###..#.....#...#
  ..#.#.....#.#.#...#.#.#......#.
  ........#.....#.#......##....##
  ##.#.#...#.#........#.....#...#
  ........#....#...............#.
  ##.###......####...#####..#....
  ...##...#..#....#........#...#.
  ...###.#..................##.#.
  ##.#.......###.......#...#.#...
  ....#..#.#...#...#....#.#.#..##
  ....#...........#..#...........
  #..#.#..#...#...#..#...........
  ...#...#.#....#..#....#........
  #....#.......#.##........#..#..
  .....#...#..#................#.
  #......#.......#..........##..#
  .#....#.#......#.#...#....##..#
  ...#.##...#......#.#...##...##.
  ..#...#..##...#...#....#.......
  .....#....#.#.#..........#.#...
  ...#...#..#....#..#.#..........
  ......#.#..........##.......#..
  .#...##.#.#...#..##..#...#.....
  ..#..#.........#........#.#.#..
  #.#..##..#.....##......#.....#.
  #..#.....#.#....#...#.#....#.#.
  ......#........##.#..#...#.....
  ...#.##.#.#......#.#..##...#..#
  ....#..###..#..#.....###....##.
  .....#...#.#.....#..........#.#
  .#...##..##.....#..#...#.#.#...
  .##.#......##...##..#...#.....#
  .#.##....#...#.##.#.#...#.#...#
  ....#.#...#....###.#.....#.....
  #.....####................#..#.
  ....#.....#...#.#.......##.#...
  .#...##.#...#..#...........#.#.
  ..#####..#.#...#...##........#.
  ...#...##........#...#.#....###
  ........#.#.#..#.....#.......#.
  ...#...#..##............##.....
  #.#..###....###.#...#.#...##.##
  ..#.##...#......#..#.........##
  .##..#..#.....#..#.........#.#.
  .#..#.#....#.##...#..#.##....##
  ..#...#.#...##.#.#...#...#....#
  #..........#.......##..##....#.
  #...###.#......#....#.........#
  #.....#...##.......##....##....
  .##.#..#.##......#.##....#..#..
  ............#.#....##.#..#....#
  .#.........##.##...#....#.....#
  ##....##..#..#....##...#.....##
  ...#.....#...........#.....##..
  ......#...#.........#.......#..
  ............#...##.#.....#.#.#.
  .#........##..........#.....#.#
  .###.........#.....#.##...#....
  .##..#...##...#..#..#.##.......
MAP

alias Point = NamedTuple(x: Int32, y: Int32)

class Map
  getter height : Int32
  private getter tiles : Array(Array(Char))
  getter width : Int32

  def initialize(map_data : String)
    @tiles = Array(Array(Char)).new

    map_data.split("\n").each do |line|
      tiles << line.strip.chars
    end

    @height = tiles.size
    # TODO: assuming each row has the same number of cols
    @width = tiles[0].size
  end

  private def at(p : Point) : Char
    wrapped_point = {x: p[:x] % width, y: p[:y] % height}
    tiles[wrapped_point[:y]][wrapped_point[:x]]
  end

  def tree?(p : Point) : Bool
    at(p) == '#'
  end
end

map = Map.new(map_data)

slopes = [
  {x: 1, y: 1},
  {x: 3, y: 1},
  {x: 5, y: 1},
  {x: 7, y: 1},
  {x: 1, y: 2},
]

trees_encountered_multiplied = 1_u64
slopes.each do |slope|
  position = {x: 0, y: 0}
  trees_encountered = 0
  while position[:y] < map.height
    trees_encountered += 1 if map.tree?(position)
    position = {x: position[:x] + slope[:x], y: position[:y] + slope[:y]}
  end

  puts "Slope #{slope} encountered #{trees_encountered} trees"
  trees_encountered_multiplied *= trees_encountered
end

puts "Total trees encountered multiplied #{trees_encountered_multiplied.format}"
